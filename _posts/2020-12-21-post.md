---
layout: post
title: LINEで家の鍵を操作しよう！
date: 2020-12-08 19:00:00 +0900
tags:
  - Engineer
  - LINE
  - SESAME
ogp: ogp20201221
---

![line_image]({{site.baseurl}}/assets/ogp/ogp20201221.png)

- toc
{:toc}

## はじめに

[@shimewtr](https://twitter.com/shimewtr)と申します。  
普段は Ruby on Rails を用いてスマートフォンアプリのバックエンド開発をしています。  
**世界中のエンジニア**は外出するとき、**極力持ち物を減らしたい**と思っていますよね？  
もちろん私も思っています。

家の鍵にスマートロックの [**SESAME**](https://jp.candyhouse.co/) をつけ、スマートフォンから鍵の解錠・施錠をできるようにして、**スマートフォンだけを持って**外出することを心がけています。

SESAME で家の鍵の解錠・施錠ができることには十二分に満足しているのですが、公式アプリの挙動に不満があります…。  
公式アプリは鍵の状態確認が長く、接続するまでに時間がかかるため、家の扉の前で接続を待って立ちすくむことが何度もありました。

[SESAME　の API](https://docs.candyhouse.co/)で鍵を操作すると待機時間を削減できることを知り、API から操作できるようにしました。

## つくったもの

以下の構成で実装しています。

![line_image]({{site.baseurl}}/assets/images/posts/2020-12-21/diagram.png)

1. LINE 上のボタンをタップ
2. Webhook で Lambda を発火
3. SESAME API を叩く
4. 結果を Lambda に返す
5. 結果に応じて LINE で返信するテキストを返す
6. LINE でメッセージを返す

我が家は私と妻の二人暮らしで、妻はあまり IT に明るくないため、日頃から使っている LINE を用いて鍵の操作を行えるようにしました。

![line_image]({{site.baseurl}}/assets/images/posts/2020-12-21/line_image.png)

↑の画像のように LINE Messaging API を用いるとボタン上の UI を簡単に作ることができます。  
(画像の下部の鍵のアイコンがそれぞれボタンになっています。)

また、LINE からのメッセージを受け取り、SESAME の API を叩く処理は Lambda で実装しています。API Gateway で LINE からの Webhook の受け口を簡単に用意でき、十分な無料枠があり、費用をかけずに実装できるためです。

## まとめ

接続状況を気にせずできる
